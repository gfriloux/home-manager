{ pkgs, config, callPackage, ... }:

{
  services.polybar = {
    enable = true;
    package = pkgs.polybarFull;
    script = ''
      polybar -r -q main &
    '';
    settings = {
      "global/wm" = {
        margin-top = 0;
        margin-bottom = 0;
      };
      "bar/main" = {
        monitor = "eDP1";
        width = "100%";
        height = 20;
        "fixed-center" = "true";
        background = "\${colors.background}";
        foreground = "\${colors.foreground}";
        "border-size" = 7;
        "border-color" = "#66000000";
        padding-left = 0;
        padding-right = 0;
        module-margin-left = 1;
        module-margin-right = 1;
        font-0 = "font DejaVu Sans Mono Book:pixelsize=8;2";
        font-1 = "Iosevka Nerd Font:pixelsize=8;3";
        font-2 = "Iosevka Nerd Font:style=Medium:size=8;3";
        modules-left = "i3 cpu memory filesystem xwindow";
        modules-center = "pandora-good pandora-warning pandora-critical pandora-unknown";
        modules-right = "mails updates-pacman-aurhelper uptime backlight-acpi  pulseaudio  battery date powermenu";
        tray-position = "left";
        cursor-click = "pointer";
        cursor-scroll = "ns-resize";
      };
      "settings" = {
        screenchange-reload = "true";
        pseudo-transparency = "true";
      };
      "colors" = {
        background = "#4D000000";
        background-alt = "#00897b";
        foreground = "#dfdfdf";
        foreground-alt = "#555";
        primary = "#ffb52a";
        secondary = "#e60053";
        alert = "#ff0000";
        network = "#ff6666";
        eth = "#b614ff";
        memory= "#4bffdc";
        cpu = "#ff69b4";
        battery = "#11ad45";
        temperature = "#ffa700";
        date = "#d2de40";
        power = "#00dbdd";
        launcher = "#ff7d7d";
        backlight = "#5f9ea0";
        workspace = "#005b96";
        white = "#f5f5f5";
        black = "#000000";
        xwindow = "#2fff00";
        uptime = "#6db474";
        i3 = "#005b96";
      };
      "module/xbacklight" = {
        type = "internal/xbacklight";
        format = "<ramp><label>";
        label = "%percentage%%";
        label-background = "\${colors.white}";
        label-foreground = "\${colors.black}";
        label-padding = 1;
        ramp-0 = "";
        ramp-1 = "";
        ramp-2 = "";
        ramp-padding = 1;
        ramp-background = "\${colors.backlight}";
        ramp-foreground = "\${colors.black}";
      };
      "module/backlight-acpi" = {
        "inherit" = "module/xbacklight";
        type = "internal/backlight";
        card = "intel_backlight";
        enable-scroll = "true";
      };
        "module/xwindow" = {
        type = "internal/xwindow";
        format = "<label>";
        format-prefix = "";
        format-prefix-background = "\${colors.xwindow}";
        format-prefix-foreground = "\${colors.black}";
        format-prefix-padding = 1;
        label = "%title:0:30:...%";
        label-background = "\${colors.white}";
        label-foreground = "\${colors.black}";
        label-padding = 1;
        label-empty = "Desktop";
        label-empty-background = "\${colors.white}";
        label-empty-foreground = "\${colors.black}";
        label-empty-padding = 1;
      };
      "module/i3" = {
        type = "internal/i3";
        format = "<label-state>";
        index-sort = "true";
        wrapping-scroll = "false";
        label-mode = "%mode%";
        label-mode-padding = 2;
        label-mode-foreground = "#000";
        label-mode-background = "\${colors.workspace}";
        label-unfocused = "%index%";
        label-unfocused-padding = 2;
        label-unfocused-background = "\${colors.white}";
        label-unfocused-foreground = "\${colors.i3}";
        label-focused = "%index%";
        label-focused-background = "\${colors.i3}";
        label-focused-foreground = "\${colors.white}";
        label-focused-padding = 2;
        label-urgent = "%index%";
        label-urgent-background = "\${colors.alert}";
        label-urgent-foreground = "\${colors.black}";
        label-urgent-padding = 2;
        label-visible = "%index%";
        label-visible-background = "\${colors.white}";
        label-visible-foreground = "\${colors.black}";
        label-visible-padding = 2;
        label-separator = "|";
        label-separator-foreground = "\${colors.black}";
        label-seprator-padding = 2;
      };
      "module/pulseaudio" = {
        type = "internal/pulseaudio";
        sink = "alsa_output.pci-0000_00_1f.3.analog-stereo";
        use-ui-max = "false";
        format-volume = "<ramp-volume><label-volume>";
        label-volume = "%percentage%%";
        label-volume-foreground = "\${colors.black}";
        label-volume-background = "\${colors.white}";
        label-volume-padding = 1;
        format-muted = "<label-muted>";
        format-muted-prefix = "婢";
        format-muted-prefix-background = "\${colors.primary}";
        format-muted-prefix-foreground = "\${colors.black}";
        format-muted-prefix-padding = 1;
        label-muted = "Muted";
        label-muted-foreground = "\${colors.black}";
        label-muted-background = "\${colors.white}";
        label-muted-padding = 1;
        ramp-volume-0 = "";
        ramp-volume-1 = "";
        ramp-volume-2 = "墳";
        ramp-volume-padding = 1;
        ramp-volume-background = "\${colors.primary}";
        ramp-volume-foreground = "\${colors.black}";
        click-right = "exec pavucontrol";
      };
      "module/battery" = {
        type = "internal/battery";
        battery = "BAT0";
        adapter = "AC0";
        full-at = 98;
        format-charging = "<animation-charging><label-charging>";
        label-charging-background = "\${colors.white}";
        label-charging-foreground= "\${colors.black}";
        label-charging-padding = 1;
        format-discharging = "<ramp-capacity><label-discharging>";
        label-discharging-foreground = "\${self.label-charging-foreground}";
        label-discharging-background = "\${self.label-charging-background}";
        label-discharging-padding = 1;
        format-full = "<label-full>";
        label-full = "100%";
        label-full-background = "\${colors.white}";
        label-full-foreground = "\${colors.black}";
        label-full-padding = 1;
        format-full-prefix = "";
        format-full-prefix-padding = 1;
        format-full-prefix-background = "\${colors.battery}";
        format-full-prefix-foreground = "\${colors.white}";
        ramp-capacity-0 = "";
        ramp-capacity-1 = "";
        ramp-capacity-2 = "";
        ramp-capacity-3 = "";
        ramp-capacity-4 = "";
        ramp-capacity-foreground = "\${colors.black}";
        ramp-capacity-background = "\${colors.battery}";
        ramp-capacity-padding = 1;
        animation-charging-0 = "";
        animation-charging-1 = "";
        animation-charging-2 = "";
        animation-charging-3 = "";
        animation-charging-4 = "";
        animation-charging-foreground = "\${colors.black}";
        animation-charging-background = "\${colors.battery}";
        animation-charging-padding = 1;
      };
      "module/powermenu" = {
        type = "custom/menu";
        expand-right = "true";
        format-spacing = 1;
        label-open = "";
        label-open-padding = 1;
        label-open-background = "\${colors.power}";
        label-open-foreground = "\${colors.black}";
        label-close = "";
        label-close-foreground = "\${colors.black}";
        label-close-background = "\${colors.power}";
        label-close-padding = 1;
        label-separator = "|";
        label-separator-foreground = "\${colors.power}";
        menu-0-0 = " reboot";
        menu-0-0-padding = 1;
        menu-0-0-exec = "systemctl reboot";
        menu-0-1 = " power off";
        menu-0-1-padding = 1;
        menu-0-1-exec = "systemctl poweroff";
      };
      "module/filesystem" = {
        type = "internal/fs";
        interval = 25;
        format-mounted = "<label-mounted>";
        format-mounted-prefix = "  ";
        format-mounted-prefix-foreground = "\${colors.date}";
        mount-0 = "/home";
        mount-1 = "/";
        label-mounted =  "%mountpoint% : %percentage_used%%";
        format-mounted-underline = "\${colors.date}";
        label-unmounted = "%mountpoint% not mounted";
        label-unmounted-foreground = "\${colors.foreground-alt}";
      };
      "module/cpu" = {
        type = "internal/cpu";
        interval = 2;
        format-prefix = "";
        format-prefix-background = "\${colors.cpu}";
        format-prefix-foreground = "\${colors.black}";
        format-prefix-padding = 1;
        label = "%percentage:2%%";
        label-background = "\${colors.white}";
        label-foreground = "\${colors.black}";
        label-padding = 1;
      };
      "module/memory" = {
        type = "internal/memory";
        interval = 2;
        format-prefix = "";
        format-prefix-background = "\${colors.memory}";
        format-prefix-foreground = "\${colors.black}";
        format-prefix-padding = 1;
        label = "%percentage_used%%";
        label-background = "\${colors.white}";
        label-foreground = "\${colors.black}";
        label-padding = 1;
      };
      "module/date" = {
        type = "internal/date";
        interval = 5;
        time = " %I:%M %p";
        time-alt = " %a, %d %b %Y";
        format = "<label>";
        label-background = "\${colors.white}";
        label-foreground = "\${colors.black}";
        label-padding = 1;
        format-prefix = "";
        format-prefix-padding = 1;
        format-prefix-foreground = "\${colors.black}";
        format-prefix-background = "\${colors.date}";
        label = "%time%";
      };
      "module/updates-pacman-aurhelper" = {
        type = "custom/script";
        exec = "~/.config/polybar/scripts/updates-pacman-aurhelper.sh";
        format = "<label>";
        format-prefix = "";
        format-prefix-background = "\${colors.network}";
        format-prefix-foreground = "\${colors.black}";
        format-prefix-padding = 1;
        label = "%output%";
        label-background = "\${colors.white}";
        label-foreground = "\${colors.black}";
        label-padding = 1;
        interval = 600;
      };
      "module/mails" = {
        type = "custom/script";
        exec = "/home/kuri/.nix-profile/bin/notmuch count tag:unread";
        interval = 10;
        format = "<label>";
        format-prefix = "";
        format-prefix-background = "\${colors.memory}";
        format-prefix-foreground = "\${colors.black}";
        format-prefix-padding = 1;
        label = "%output%";
        label-background = "\${colors.white}";
        label-foreground = "\${colors.black}";
        label-padding = 1;
      };
      "module/uptime" = {
        type = "custom/script";
        exec = "/usr/sbin/uptime -p | /usr/sbin/cut -f 2- -d ' '";
        interval = 100;
        format = "<label>";
        format-prefix = "";
        format-prefix-background = "\${colors.uptime}";
        format-prefix-foreground = "\${colors.black}";
        format-prefix-padding = 1;
        label = "%output%";
        label-background = "\${colors.white}";
        label-foreground = "\${colors.black}";
        label-padding = 1;
      };
    };
  };

  home.file.".config/polybar/scripts/updates-pacman-aurhelper.sh".source = ../files/polybar/updates-pacman-aurhelper.sh;
}
